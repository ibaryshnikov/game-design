# Сервер игры

Серверная часть игры, которая так же может раздавать
веб клиент

## Веб клиент

Для теста сервера понадобится собрать веб клиент:

```bash
cd client-web
./build.sh
```


## Запуск

Для локального теста достаточно выполнить:

```bash
cd server
cargo run
```

и перейти на `http://localhost:8080/game`


## Загрузка и запуск на удалённом сервере

Для этого понадобится собрать веб клиент и сервер игры
в оптимизированном режиме (release mode):

```bash
# собираем клиент
cd client-web
./release_build.sh
# собираем сервер
cd ../server
cargo build --release
```

После этого у нас есть всё необходимое для загрузки игры на сервер.
Можем загружать файлы игры:

```bash
# Для начала нужно создать несколько папок на удалённом сервере.
# Подключаемся через ssh на сервер и выполняем
mkdir /game
cd /game
mkdir bin
mkdir client-web
# Далее для удобства открываем отдельный терминал.
# Загружаем файлы самой игры (способности, противники, уровни, ...)
scp -r data user@ip:/game
# Загружаем сервер и файл конфигурации сервера
cd server
scp target/release/server user@ip:/game
scp config.toml user@ip:/game
# Загружаем веб клиент
cd ../client-web
scp -r dist user@ip:/game
# Перемещаем файлы на удалённом сервере в нужные папки.
# Для этого возвращаемся в терминал, в котором мы делали ssh и выполняем:
mv server bin
mv config.toml bin
mv dist client-web
# Изменяем порт в файле config.toml на 80
# Проверяем файл конфигурации
cat bin/config.toml 
# Должно вывести: port = 80
```

После загрузки всех файлов игры на удалённый сервер мы готовы к запуску
сервера самой игры. 

```bash
# Запускаем сервер игры
cd bin
./server
# Для проверки переходим на http://ip_адрес_сервера/game
# Чтобы сервер игры не останавливался после выхода из сессии ssh
# можно использовать утилиту nohup
nohup ./server > /dev/null 2>&1 &
# Чтобы посмотреть айди процесса сервера
ps ax | grep server
